<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>VR Mini Game</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script> 
  </head> 
  <body>
    <a-scene>
      <a-sky src="yt.jpg"></a-sky>
      
      <!-- Пол -->
      <a-plane position="0 0 -4" rotation="-90 0 0" width="100" height="100" src="п.jpg"></a-plane>
      
      <!-- Камера и контроллеры -->
      <a-entity id="camera" camera look-controls position="0 1.6 0" wasd-controls></a-entity>
      <a-entity id="leftHand" hand-controls="hand: left; handModelStyle: lowPoly; color: #ffcccc"></a-entity>
      <a-entity id="rightHand" hand-controls="hand: right; handModelStyle: lowPoly; color: #ffcccc"></a-entity>
      
      <!-- Объекты для сбора -->
      <a-box position="-6 0.5 -3" color="#4CC3D9" collectible></a-box>
      <a-box position="5 0.5 -2" color="#4CC3D9" collectible></a-box>
      <a-box position="-7 0.5 -1" color="#4CC3D9" collectible></a-box>
      <a-box position="8 0.5 -3" color="#4CC3D9" collectible></a-box>
      <a-box position="-1 0.5 -3" color="#4CC3D9" collectible></a-box>
      <a-box position="-2 0.5 -4" color="#4CC3D9" collectible></a-box>
      
      <!-- Текст для отображения счета -->
      <a-text id="score" value="Score: 0" position="-1.5 2.5 -5" color="black"></a-text>

      <!-- Таймер -->
      <a-text id="timer" value="Time: 30" position="1.5 2.5 -5" color="black"></a-text> 

      <!-- Текст для окончания игры -->
      <a-text id="gameOverText" value="" position="-1 4 -4" color="black"></a-text> 

      <!-- Курсор для взаимодействия -->
      <a-cursor color="black" fuse="true" fuse-timeout="500"></a-cursor>
      
    </a-scene>

    <script> 
        // Логика сбора объектов 
        AFRAME.registerComponent('collectible', { 
            init: function () { 
                this.el.addEventListener('click', () => { 
                    // Удаление объекта из сцены
                    this.el.parentNode.removeChild(this.el); 
 
                    // Обновление счета 
                    let scoreElement = document.querySelector('#score'); 
                    let score = parseInt(scoreElement.getAttribute('value').split(': ')[1]) + 1; 
                    scoreElement.setAttribute('value', 'Score: ' + score); 
                }); 
            } 
        }); 

        let timeLeft = 30; // Время игры в секундах 
        let timerElement = document.querySelector('#timer'); 

        function updateTimer() { 
            if (timeLeft > 0) { 
                timeLeft--; 
                timerElement.setAttribute('value', 'Time: ' + timeLeft); 
            } else { 
                endGame(); 
            } 
        } 

        setInterval(updateTimer, 1000); 

        function endGame() { 
            let finalScore = parseInt(document.querySelector('#score').getAttribute('value').split(': ')[1]); 
            let gameOverText = document.querySelector('#gameOverText');
            gameOverText.setAttribute('value', 'Game Over! Your final score is: ' + finalScore); 

            // Перезапуск игры (можно убрать, если не нужно)
            // location.reload(); 
        } 
    </script>

    <!-- Добавление WASD контроллера -->
    <script>
        AFRAME.registerComponent('wasd-controls', {
            schema: {
                acceleration: {type: 'number', default: 100}
            },
            init: function () {
                this.direction = new THREE.Vector3();
                this.velocity = new THREE.Vector3();
                this.el.sceneEl.addEventListener('enter-vr', () => {
                    this.el.setAttribute('wasd-controls', 'enabled', false);
                });
                this.el.sceneEl.addEventListener('exit-vr', () => {
                    this.el.setAttribute('wasd-controls', 'enabled', true);
                });
            },
            tick: function (time, timeDelta) {
                if (!this.data.enabled) return;

                const speed = this.data.acceleration * (timeDelta / 1000);
                this.direction.set(0, 0, 0);

                if (this.el.sceneEl.is('vr-mode')) {
                    return; // Disable WASD controls in VR mode
                }

                if (this.el.sceneEl.is('desktop')) {
                    if (this.keyW) this.direction.z -= speed;
                    if (this.keyS) this.direction.z += speed;
                    if (this.keyA) this.direction.x -= speed;
                    if (this.keyD) this.direction.x += speed;

                    this.direction.applyEuler(this.el.rotation);
                    this.velocity.add(this.direction);
                    this.el.position.add(this.velocity);
                }
            }
        });

        window.addEventListener('keydown', function (event) {
            if (event.key === 'w') { document.querySelector('#camera').components['wasd-controls'].keyW = true; }
            if (event.key === 's') { document.querySelector('#camera').components['wasd-controls'].keyS = true; }
            if (event.key === 'a') { document.querySelector('#camera').components['wasd-controls'].keyA = true; }
            if (event.key === 'd') { document.querySelector('#camera').components['wasd-controls'].keyD = true; }
        });

        window.addEventListener('keyup', function (event) {
            if (event.key === 'w') { document.querySelector('#camera').components['wasd-controls'].keyW = false; }
            if (event.key === 's') { document.querySelector('#camera').components['wasd-controls'].keyS = false; }
            if (event.key === 'a') { document.querySelector('#camera').components['wasd-controls'].keyA = false; }
            if (event.key === 'd') { document.querySelector('#camera').components['wasd-controls'].keyD = false; }
        });
    </script>

  </body>
</html>
